{% extends "@Tsugi/Page.twig" %}

{% block head %}
    {% for style in styles %}
        <link rel="stylesheet" type="text/css" href="{{style}}"/>
    {% endfor %}
{% endblock %}

{% block content %}   
    {% if app.tsugi.user.instructor %}
        <div id="application">

            <ul class="nav nav-tabs">
                <!--li><h1 style="margin-top: 0px;margin-bottom: 0px;padding-right: 20px;">One Button Studio: </h1></li-->
                <li class="active"><a href="#" rel="schedule">Schedule</a></li>
                <li><a href="#" rel="rec">Recordings</a></li>
            </ul>

            <div id="rec" class="tab-content" style="display:none">
                <div>
                    <table id="grid" class="table table-bordered table-hover" style="margin-top: 10px;">
                        <thead>
                            <tr>
                            <th class="text-center" style="width: 1rem;">
                            </th>
                            <th style="width: 160px;">&nbsp;</th>
                            <th data-column="title" data-sort="true" data-sortdir="asc" style="width: calc((100% - 30rem)/3)">Title</th>
                            <th data-column="start_date" data-sort="true" data-sortdir="asc" data-sorttype="date" style="width: calc((100% - 30rem)/3)">Date</th>
                            <th data-column="status" data-sort="true" data-sortdir="asc" style="width: 10em">Status</th>
                            <th style="width: 7em">Manage</th>
                        </tr></thead>
                        <tbody id="grid-body">
                    
                            <tr id="row-0375c238-e079-4db4-83f8-d1cdac37d9ba" data-status="Published">
                                <td class="text-center">
                                <input type="checkbox" id="chk-0375c238-e079-4db4-83f8-d1cdac37d9ba">
                                </label></td>
                                <td><img src="http://localhost/tsugi-static/img/1.png" class="img-responsive" style="border: 1px solid #222;"/></td>
                                <td>Teaching and Learning (Take 1)</td>
                                <td>Thu 25 May 2015, 13:00</td>
                                <td>Ready</td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="schedule" class="tab-content">
                <div class="row">
                    <div class="col-xs-9 text-center" style="padding-top: 12px;margin-bottom: 0px;">
                        <h4 id="month-title-container">
                            <a href="#" class="glyphicon glyphicon-chevron-left"></a>
                            <span id="month-title"></span>
                            <a href="#" class="glyphicon glyphicon-chevron-right"></a>
                        </h4>
                    </div>
                    <div id="timer-container" class="col-xs-3">
                        <ul class="nav nav-pills" style="float: right;margin-top: 20px;">
                            <li role="presentation"><a href="#">Week</a></li>
                            <li role="presentation" class="active"><a href="#">Month</a></li>
                            <li role="presentation" style="border-left: 1px solid #ccc; margin-left: 15px; padding-left:8px;"><a href="#">Today</a></li>
                        </ul>
                    </div>
                </div>

                <div>
                    <div class="row">
                        <div class="col-xs-9" id="calendar" style="padding-right: 0px;"></div>
                        <div class="col-xs-3" style="padding-left: 0px;">
                            <table>
                                <thead>
                                    <tr>
                                        <th style="padding-left:10px;">My Bookings</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <div id="agenda" class="record">
                                                <div class="time">June 5, 2017&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp;&nbsp;13:30 - 14:15</div>
                                                <div class="title">Using Opencast as the cornerstone for the delivery of interactive, annotated multimedia learning, in Sakai and Tsugi</div>
                                            </div>
                                            <div style="padding:2em 0px" class="text-center">
                                                <button class="btn btn-success"><i class="glyphicon glyphicon-plus" style="margin-right: 8px;"></i>Add a booking...</button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                            <!-- Legend -->
                            <div class="legend row">
                                <div class="col-xs-12">
                                    <div class="box"></diV>
                                    <div class="text">Available</diV>
                                </div>
                                <div class="col-xs-12">
                                    <div class="box me"></diV>
                                    <div class="text">My bookings</diV>
                                </div>
                                <div class="col-xs-12">
                                    <div class="box used"></diV>
                                    <div class="text">Unavailable</diV>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block footer %}
{% for script in scripts %}
    <script src="{{script}}" type="text/javascript"></script>
{% endfor %}
    <script type="text/javascript">    
        var initial_data = {{json | raw }}, data = [], current_date = new Date(), current = {};

        var defaultLocaleWeekdaysShort = 'Sun_Mon_Tue_Wed_Thu_Fri_Sat'.split('_');

        function getObj(id, arr, key) { key = key || 'id'; var o = null; $.each(arr, function (i, el) { if (el[key] == id) { o=el; return; } }); return o; };
        function getDisplayData(d, arr) { var o = null; $.each(arr, function (i, el) { if (el.date === d) { o=el; return; } }); return o; };
        
        function displayCurrent() {
            current = getDisplayData(current_date.format("YYYY-MM"), data);

            $('#month-title').html(current_date.format('MMMM, YYYY'));
            $('#calendar').html(tmpl('tmpl-calendar', {date: current_date, data: current}));
        }

        $(function () {
            data.push(initial_data);

            current_date = moment(initial_data.date, "YYYY-MM");
            displayCurrent();

            $('#calendar').on('click', '.current div[id*=d_]', function(event) {
                var _id = $(this).attr('id'),
                    _date = moment(_id,'#_M_D_H');
                
                $.post('{{booking_set}}', { title: 'Test', date: _date.format('YYYY-MM-DD HH:mm:ss') }, function( data ) {
                   console.log(data);
                }).fail(function() {
                    alert( "error" );
                });
            });

            $('#month-title-container').on('click', '.glyphicon-chevron-left', function(event) {
                event.preventDefault();
                current_date.subtract(1, 'months');
                displayCurrent();
            });

            $('#month-title-container').on('click', '.glyphicon-chevron-right', function(event) {
                event.preventDefault();
                current_date.add(1, 'months');
                displayCurrent();
            });

            $(".nav-tabs").on('click','a', function(event){
                event.preventDefault();
                $('.nav-tabs li').removeClass('active');
                $(this).parent().addClass('active');
                $('.tab-content').hide();
                $('#' + $(this).prop('rel')).show();
            });
        });
    </script>

{{ source('Booking-tmpl.html', ignore_missing = true) }}

{% endblock %}
